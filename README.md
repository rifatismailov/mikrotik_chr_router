# MikroTik CHR —è–∫ –∫–æ—Ä–µ–Ω–µ–≤–∏–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤

–¶–µ–π –ø—Ä–æ—î–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ MikroTik Cloud Hosted Router (CHR) —É Docker —è–∫ –∫–æ—Ä–µ–Ω–µ–≤–∏–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –¥–ª—è —ñ–Ω—à–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤. –¢–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ–∑–≤–æ–ª—è—î —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—é, VLAN/VRF, VPN, NAT, Firewall, WireGuard —Ç–∞ —ñ–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, –¥–æ—Å—Ç—É–ø–Ω—ñ –≤ MikroTik, –ø—Ä—è–º–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ—ó —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏.

–•–æ—á–∞ —ñ–¥–µ—è –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∞ –∑ –ø–µ—Ä—à–æ–≥–æ —Ä–∞–∑—É, —è –ø–æ–∫–∞–∑—É—é, —è–∫ —Å–∞–º–µ –≤–¥–∞–ª–æ—Å—è —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–±–æ—á–µ —Ä—ñ—à–µ–Ω–Ω—è.

–î–ª—è –ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `mikrotik-chr` –∑ –∫—ñ–ª—å–∫–æ–º–∞ –º–µ—Ä–µ–∂–µ–≤–∏–º–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏. –£ –º–æ—î–º—É –≤–∏–ø–∞–¥–∫—É —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ 5 —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ ‚Äî –≤—ñ–¥ `mikrotik_net_a` –¥–æ `mikrotik_net_e`, –¥–µ `mikrotik_net_a` –≤–∏–∫–æ–Ω—É—î —Ä–æ–ª—å –≤—Ö—ñ–¥–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –¥–ª—è WAN.

``
[HOST] (—Ñ—ñ–∑–∏—á–Ω–æ –≤ –º–µ—Ä–µ–∂—ñ 192.168.88.0/24)
    ‚Üï
[Docker Bridge mikrotik_net_a] ‚Üí 172.21.0.1 (default gateway —É bridge)
    ‚Üï
[MikroTik CHR container]  ‚Üí ether1 = 172.21.0.2
                          ‚Üí ether2 = 192.168.1.1
                          ‚Üí ether3 = 192.168.2.1
                          ‚Üí ether4 = 192.168.3.1
                          ‚Üí ether5 = 192.168.4.1
    ‚Üï
[–Ü–Ω—à—ñ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –≤ –º–µ—Ä–µ–∂–∞—Ö mikrotik_net_b ‚Üí mikrotik_net_e]

``

---

## üîß Docker Compose (`docker-compose.yml`)

```yaml
version: "3.8"

services:
  mikrotik-chr:
    image: mikrotik/chr
    container_name: chr-router
    privileged: true
    restart: unless-stopped
    ports:
      - "8291:8291"            # WinBox
      - "51820:51820/udp"      # WireGuard
      - "1701:1701/udp"        # L2TP VPN
    networks:
      mikrotik_net_a:
        ipv4_address: 172.21.0.2
      mikrotik_net_b:
        ipv4_address: 192.168.1.2
      mikrotik_net_c:
        ipv4_address: 192.168.2.2
      mikrotik_net_d:
        ipv4_address: 192.168.3.2
      mikrotik_net_e:
        ipv4_address: 192.168.4.2

networks:
  mikrotik_net_a:
    name: mikrotik_net_a
    driver: bridge
    ipam:
      config:
        - subnet: 172.21.0.0/24
          gateway: 172.21.0.1
  mikrotik_net_b:
    name: mikrotik_net_b
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.1.0/24
          gateway: 192.168.1.1
  mikrotik_net_c:
    name: mikrotik_net_c
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.2.0/24
          gateway: 192.168.2.1
  mikrotik_net_d:
    name: mikrotik_net_d
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.3.0/24
          gateway: 192.168.3.1
  mikrotik_net_e:
    name: mikrotik_net_e
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.4.0/24
          gateway: 192.168.4.1
```

---

## üìú MikroTik CHR RSC —Å–∫—Ä–∏–ø—Ç (—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞)

–¶–µ–π RSC-—Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É—î:

* –æ—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
* –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è WAN (DHCP + –º–∞—Ä—à—Ä—É—Ç –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
* —Ä–æ–∑–ø–æ–¥—ñ–ª LAN –ø–æ 4 —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö
* –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é DHCP-—Å–µ—Ä–≤–µ—Ä—ñ–≤
* –¥–æ–¥–∞–≤–∞–Ω–Ω—è WireGuard
* –±–∞–∑–æ–≤—ñ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–∞—î—Ä–≤–æ–ª—É

–§–∞–π–ª: `init-config.rsc`

> üîΩ [–ø–æ–≤–Ω–∏–π –≤–º—ñ—Å—Ç –¥–∏–≤. —É —Ñ–∞–π–ª—ñ init-config.rsc](./init-config.rsc)

---

``‚ö†Ô∏è –ü—Ä–∏–º—ñ—Ç–∫–∞: –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ –±–∞–≥–∞—Ç–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤, Docker –Ω–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏–º–µ –º–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥ (NAT) –¥–æ mikrotik_net_a –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ ‚Äî —Ç–æ–º—É –ø–æ—Ç—Ä—ñ–±–µ–Ω —Ä—É—á–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—î—é —Ç–∞ NAT.``

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É —ñ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MikroTik —ñ–∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó –º–µ—Ä–µ–∂—ñ. –û—Å–∫—ñ–ª—å–∫–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∑–æ–≤–Ω—ñ –Ω–µ–º–æ–∂–ª–∏–≤–∏–π –Ω–∞–ø—Ä—è–º—É (–æ–∫—Ä—ñ–º CLI —á–µ—Ä–µ–∑ Docker), —è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ WireGuard —ñ –ø—Ä–æ–±—Ä–æ—Å–∏–≤ –ø–æ—Ä—Ç–∏ –¥–ª—è VPN. –¢–∞–∫–æ–∂ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ L2TP —ñ –ø–æ—Ä—Ç 8291 –¥–ª—è WinBox.

–î–ª—è –ø–æ–≤–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å—Ç–≤–æ—Ä–µ–Ω–æ bash-—Å–∫—Ä–∏–ø—Ç `iptables-setup.sh`, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ DNAT/NAT —á–µ—Ä–µ–∑ iptables.

## üîí Bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è NAT/DNAT —á–µ—Ä–µ–∑ iptables

–°–∫—Ä–∏–ø—Ç `iptables-setup.sh` –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ DNAT —Ç–∞ –º–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ MikroTik —ñ–∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó LAN-–º–µ—Ä–µ–∂—ñ. –í—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–º–∏–∫–∞—î iptables –Ω–∞ `legacy`, –¥–æ–¥–∞—î DNAT, FORWARD —ñ MASQUERADE –ø—Ä–∞–≤–∏–ª–∞ —Ç–∞ –∞–∫—Ç–∏–≤—É—î IP forwarding.

### –û—Å–Ω–æ–≤–Ω—ñ –∑–∞–¥–∞—á—ñ:

* DNAT/forward –ø–æ—Ä—Ç—ñ–≤ (WinBox, WireGuard, L2TP)
* –ú–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥ –¥–ª—è –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ —Ç—Ä–∞—Ñ—ñ–∫—É
* –î–æ–∑–≤—ñ–ª —Ç—Ä–∞—Ñ—ñ–∫—É –∑ –ª–æ–∫–∞–ª—å–Ω–æ—ó –º–µ—Ä–µ–∂—ñ
* –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

–§–∞–π–ª: `iptables-setup.sh`
> üîΩ [–ø–æ–≤–Ω–∏–π –≤–º—ñ—Å—Ç –¥–∏–≤. —É —Ñ–∞–π–ª—ñ iptables-setup.sh](./iptables-setup.sh)
---

## ‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ WireGuard

WireGuard-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `wg0` —Å–ª—É—Ö–∞—î –Ω–∞ `51820/udp`, –º–∞—î –∞–¥—Ä–µ—Å—É `10.0.0.1/24` —ñ –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—Ç—É–ø –∫–ª—ñ—î–Ω—Ç–∞–º `10.0.0.2` —Ç–∞ `10.0.0.3`. –ü—Ä–∞–≤–∏–ª–∞ —Ñ–∞—î—Ä–≤–æ–ª—É –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≥–Ω—É—á–∫–∏–π (granular) –¥–æ—Å—Ç—É–ø –¥–æ –ø—ñ–¥–º–µ—Ä–µ–∂:

* `10.0.0.2` –º–∞—î –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö LAN
* `10.0.0.3` –æ–±–º–µ–∂–µ–Ω–æ (–¥–æ—Å—Ç—É–ø –ª–∏—à–µ –¥–æ –¥–µ—è–∫–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂)

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞

1. **WinBox –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:** IP `192.168.88.200:8291` (192.168.88.200 ‚Äî IP –º–æ–≥–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∞; —É –≤–∞—Å –º–æ–∂–µ –±—É—Ç–∏ —ñ–Ω—à–∏–π)
2. **WireGuard –∫–ª—ñ—î–Ω—Ç–∏:** —á–µ—Ä–µ–∑ –ø—É–±–ª—ñ—á–Ω—ñ –∫–ª—é—á—ñ
3. **DHCP –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞:** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –æ—Ç—Ä–∏–º—É—é—Ç—å IP –≤—ñ–¥ MikroTik ``–Ω–∞–∂–∞–ª—å —Ü—è –æ–ø—Ü—ñ—è –Ω–µ —Å–ø—Ä–∞—Ü—å–≤–∞–ª–∞ —ñ–∑-–∑–∞ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç–µ–π Docker —Ç–∞ DHCP —Å–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–∂–µ —Ä–∞–∑–¥–æ–≤–∞—Ç–∏ –∞–¥—Ä–µ—Å–∞ —Ç–∞–∫ —è–∫ –¥–æ–∫–µ—Ä —Å–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–∑–Ω–∞—á–∞—î –∞–¥—Ä–µ—Å–∞—Ü—ñ—é –∑–≥—ñ–¥–Ω–æ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ –≤ —è–∫–æ–º—É –≤–æ–Ω–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –ê–ª–µ –≤–∏ —Å–∞–º—ñ –º–æ–∂–µ—Ç–µ —É yml –≤–∫–∞–∑–∞—Ç–∏ –∞–¥—Ä–µ—Å –∑–∞ –≤–∞—à–∏–º –±–∞–∂–∞–Ω–Ω—è–º –∑–≥—ñ–¥–Ω–æ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ –≤ —è–∫–æ–º—É –±—É–¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä``
4. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è:** –∑ —ñ–Ω—à–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ —î –¥–æ—Å—Ç—É–ø –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó –º–µ—Ä–µ–∂—ñ —á–µ—Ä–µ–∑ MikroTik

---

## üìå –ü—Ä–∏–º—ñ—Ç–∫–∏

* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—É `mikrotik-chr` **–ø–æ—Ç—Ä—ñ–±–µ–Ω —Ä–µ–∂–∏–º `privileged: true`** –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ –º–µ—Ä–µ–∂–∞–º–∏
* –°–∫—Ä–∏–ø—Ç–∏ —Å–ª—ñ–¥ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑ –ø—Ä–∞–≤–∞–º–∏ `sudo`
* MikroTik CHR –ø—ñ–¥—Ç—Ä–∏–º—É—î RouterOS –ø–æ–≤–Ω—ñ—Å—Ç—é: –º–æ–∂–Ω–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞—Ç–∏ hotspot, VPN, tunnels, firewall scripts —Ç–æ—â–æ –≤ –º–æ—î–º—É –≤–∏–ø–∞–¥–∫—É —è —Ä–æ–∑–≥–æ—Ä–Ω—É–≤ VPN —Ü–µ WireGuard. 

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

```
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ init-config.rsc
‚îú‚îÄ‚îÄ iptables-setup.sh
‚îî‚îÄ‚îÄ README.md (—Ü—è —Å—Ç–∞—Ç—Ç—è)
```

---

## üìé TODO

* [ ] –î–æ–¥–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ `ubuntu-desktop` –∑ DHCP –±–µ–∑ `ipv4_address`
* [ ] –î–æ–¥–∞—Ç–∏ —Å—Ö–µ–º—É –º–µ—Ä–µ–∂—ñ (SVG –∞–±–æ PNG)
* [ ] –û–ø–∏—Å–∞—Ç–∏ —Ç–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ –ø—Ä–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ

---

–ó–∞–ª–∏—à–∞–π—Å—è –∑ –Ω–∞–º–∏, –¥–∞–ª—ñ –±—É–¥–µ üî•
—è–∫—â–æ –∑–Ω–∞–π—à–ª–∏ –ø–æ–º–∏–ª–∫—É –∞–±–æ —Ö–æ—á–µ—Ç–µ –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –ø–∏—à–∏—Ç—å:
[üì≤ Telegram](https://t.me/RifatIsmailov)
[üîó LinkedIn](https://www.linkedin.com/in/—Ç–≤–æ—î_—ñ–º º—è/)
